plugins {
    id 'application'
    id 'com.google.cloud.tools.jib' version '3.3.2'
}

dependencies {
    implementation project(':featureflag-adapter')
    implementation project(':featureflag-usecase')

    implementation 'org.springframework.boot:spring-boot-starter-web:_'

    // monitoring
    implementation 'org.springframework.boot:spring-boot-starter-actuator:_'
    implementation 'io.micrometer:micrometer-registry-prometheus:_'

    implementation("io.swagger.core.v3:swagger-annotations:_")
    implementation("org.springdoc:springdoc-openapi-starter-webmvc-ui:_")
}

test {
    useJUnitPlatform()
}

jib {
    setMainClassName('com.fastcampus.featureflag.app.FastcampusFeatureflagApplication')
    from {
        image = "amazoncorretto:17"
        platforms {
            platform {
                architecture = 'arm64'
                os = 'linux'
            }
        }
    }
    to {
        image = "${project.name}".toLowerCase()+ ":${project.version}"
    }
    container {
        ports = ['8080']
        jvmFlags = ['-Xms512m', '-Xmx512m', '-Dspring.profiles.active=local', '-XX:+UseContainerSupport', '-Dserver.port=8080', '-Dfile.encoding=UTF-8']
    }
}

tasks.bootRun {
    systemProperty("spring.profiles.active", "local")
    setMainClassName('com.fastcampus.featureflag.app.FastcampusFeatureflagApplication')
}